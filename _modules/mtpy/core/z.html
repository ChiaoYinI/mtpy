
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>mtpy.core.z &#8212; mtpy 1.01.01 documentation</title>
    <link rel="stylesheet" href="../../../_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <script type="text/javascript" src="../../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../master_doc.html">mtpy 1.01.01 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" accesskey="U">Module code</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for mtpy.core.z</h1><div class="highlight"><pre>
<span></span><span class="ch">#!/usr/bin/env python</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">.. module:: Z</span>
<span class="sd">   :synopsis: Deal with MT responses Z and Tipper</span>

<span class="sd">.. moduleauthor:: Jared Peacock &lt;jpeacock@usgs.gov&gt;</span>
<span class="sd">.. moduleauthor:: Lars Krieger</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">cmath</span>
<span class="kn">import</span> <span class="nn">copy</span>
<span class="kn">import</span> <span class="nn">math</span>

<span class="c1"># =================================================================</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="kn">import</span> <span class="nn">mtpy.utils.calculator</span> <span class="k">as</span> <span class="nn">MTcc</span>
<span class="kn">import</span> <span class="nn">mtpy.utils.exceptions</span> <span class="k">as</span> <span class="nn">MTex</span>
<span class="kn">from</span> <span class="nn">mtpy.utils.mtpylog</span> <span class="k">import</span> <span class="n">MtPyLog</span>


<span class="c1"># get a logger object for this module, using the utility class MtPyLog to</span>
<span class="c1"># config the logger</span>
<span class="c1"># _logger = MtPyLog.get_mtpy_logger(__name__)</span>


<span class="c1"># ==============================================================================</span>
<span class="c1"># Resistivity and phase object</span>
<span class="c1"># ==============================================================================</span>
<div class="viewcode-block" id="ResPhase"><a class="viewcode-back" href="../../../core.html#mtpy.core.z.ResPhase">[docs]</a><span class="k">class</span> <span class="nc">ResPhase</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    resistivity and phase container</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">z_array</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">z_err_array</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span> <span class="o">=</span> <span class="n">MtPyLog</span><span class="o">.</span><span class="n">get_mtpy_logger</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_z</span> <span class="o">=</span> <span class="n">z_array</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_z_err</span> <span class="o">=</span> <span class="n">z_err_array</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_resistivity</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_phase</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_resistivity_err</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_phase_err</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">freq</span> <span class="o">=</span> <span class="n">freq</span>

        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">resistivity</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_resistivity</span>

    <span class="nd">@resistivity</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">resistivity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">res_array</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_resistivity</span> <span class="o">=</span> <span class="n">res_array</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">resistivity_err</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_resistivity_err</span>

    <span class="nd">@resistivity_err</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">resistivity_err</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">res_err_array</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_resistivity_err</span> <span class="o">=</span> <span class="n">res_err_array</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">phase</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_phase</span>

    <span class="nd">@phase</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">phase</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">phase_array</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_phase</span> <span class="o">=</span> <span class="n">phase_array</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">phase_err</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_phase_err</span>

    <span class="nd">@phase_err</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">phase_err</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">phase_err_array</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_phase_err</span> <span class="o">=</span> <span class="n">phase_err_array</span>

<div class="viewcode-block" id="ResPhase.compute_resistivity_phase"><a class="viewcode-back" href="../../../core.html#mtpy.core.z.ResPhase.compute_resistivity_phase">[docs]</a>    <span class="k">def</span> <span class="nf">compute_resistivity_phase</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">z_array</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">z_err_array</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                  <span class="n">freq</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        compute resistivity and phase from z and z_err</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">z_array</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_z</span> <span class="o">=</span> <span class="n">z_array</span>
        <span class="k">if</span> <span class="n">z_err_array</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_z_err</span> <span class="o">=</span> <span class="n">z_err_array</span>
        <span class="k">if</span> <span class="n">freq</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">freq</span> <span class="o">=</span> <span class="n">freq</span>

        <span class="c1">#if self._z is None or self._z_err is None or self.freq is None: #The _z_err can be None!!!</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_z</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">freq</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">MT_Z_Error</span><span class="p">(</span><span class="s1">&#39;Values are None, check _z, _z_err, freq&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_resistivity</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">apply_along_axis</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">freq</span> <span class="o">*</span> <span class="mf">0.2</span><span class="p">,</span>
                                                <span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_z</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_phase</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">rad2deg</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">angle</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_z</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_resistivity_err</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_resistivity</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_phase_err</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_phase</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">)</span>

        <span class="c1"># calculate resistivity and phase</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_z_err</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">idx_f</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">freq</span><span class="o">.</span><span class="n">size</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
                    <span class="k">for</span> <span class="n">jj</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
                        <span class="n">r_err</span><span class="p">,</span> <span class="n">phi_err</span> <span class="o">=</span> <span class="n">MTcc</span><span class="o">.</span><span class="n">z_error2r_phi_error</span><span class="p">(</span>
                            <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_z</span><span class="p">[</span><span class="n">idx_f</span><span class="p">,</span> <span class="n">ii</span><span class="p">,</span> <span class="n">jj</span><span class="p">]),</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">_z_err</span><span class="p">[</span><span class="n">idx_f</span><span class="p">,</span> <span class="n">ii</span><span class="p">,</span> <span class="n">jj</span><span class="p">],</span>
                            <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_z</span><span class="p">[</span><span class="n">idx_f</span><span class="p">,</span> <span class="n">ii</span><span class="p">,</span> <span class="n">jj</span><span class="p">]),</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">_z_err</span><span class="p">[</span><span class="n">idx_f</span><span class="p">,</span> <span class="n">ii</span><span class="p">,</span> <span class="n">jj</span><span class="p">])</span>

                        <span class="bp">self</span><span class="o">.</span><span class="n">_resistivity_err</span><span class="p">[</span><span class="n">idx_f</span><span class="p">,</span> <span class="n">ii</span><span class="p">,</span> <span class="n">jj</span><span class="p">]</span> <span class="o">=</span> \
                            <span class="mf">0.4</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_z</span><span class="p">[</span><span class="n">idx_f</span><span class="p">,</span> <span class="n">ii</span><span class="p">,</span> <span class="n">jj</span><span class="p">])</span> <span class="o">/</span> \
                            <span class="bp">self</span><span class="o">.</span><span class="n">freq</span><span class="p">[</span><span class="n">idx_f</span><span class="p">]</span> <span class="o">*</span> <span class="n">r_err</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_phase_err</span><span class="p">[</span><span class="n">idx_f</span><span class="p">,</span> <span class="n">ii</span><span class="p">,</span> <span class="n">jj</span><span class="p">]</span> <span class="o">=</span> <span class="n">phi_err</span></div>

<div class="viewcode-block" id="ResPhase.set_res_phase"><a class="viewcode-back" href="../../../core.html#mtpy.core.z.ResPhase.set_res_phase">[docs]</a>    <span class="k">def</span> <span class="nf">set_res_phase</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">res_array</span><span class="p">,</span> <span class="n">phase_array</span><span class="p">,</span> <span class="n">freq</span><span class="p">,</span> <span class="n">res_err_array</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                      <span class="n">phase_err_array</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set values for resistivity (res - in Ohm m) and phase</span>
<span class="sd">        (phase - in degrees), including error propagation.</span>


<span class="sd">        :param res_array: resistivity array in Ohm-m</span>
<span class="sd">        :type res_array: np.ndarray(num_freq, 2, 2)</span>

<span class="sd">        :param phase_array: phase array in degrees</span>
<span class="sd">        :type phase_array: np.ndarray(num_freq, 2, 2)</span>

<span class="sd">        :param freq: frequency array in Hz</span>
<span class="sd">        :type freq: np.ndarray(num_freq)</span>

<span class="sd">        :param res_err_array: resistivity error array in Ohm-m</span>
<span class="sd">        :type res_err_array: np.ndarray(num_freq, 2, 2)</span>

<span class="sd">        :param phase_err_array: phase error array in degrees</span>
<span class="sd">        :type phase_err_array: np.ndarray(num_freq, 2, 2)</span>


<span class="sd">        &quot;&quot;&quot;</span>

        <span class="nb">print</span> <span class="s1">&#39;Reseting z and z_err&#39;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_resistivity</span> <span class="o">=</span> <span class="n">res_array</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_phase</span> <span class="o">=</span> <span class="n">phase_array</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">freq</span> <span class="o">=</span> <span class="n">freq</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_resistivity_err</span> <span class="o">=</span> <span class="n">res_err_array</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_phase_err</span> <span class="o">=</span> <span class="n">phase_err_array</span>

        <span class="c1"># assert real array:</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">res_array</span><span class="p">))</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">MTex</span><span class="o">.</span><span class="n">MTpyError_inputarguments</span><span class="p">(</span><span class="s1">&#39;Error - array &quot;res&quot; is not&#39;</span> <span class="o">+</span> \
                                                <span class="s1">&#39;real valued !&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">phase_array</span><span class="p">))</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">MTex</span><span class="o">.</span><span class="n">MTpyError_inputarguments</span><span class="p">(</span><span class="s1">&#39;Error - array &quot;phase&quot; is&#39;</span> <span class="o">+</span> \
                                                <span class="s1">&#39;not real valued !&#39;</span><span class="p">)</span>

        <span class="n">abs_z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">5.0</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">freq</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">resistivity</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_z</span> <span class="o">=</span> <span class="n">abs_z</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">phase</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_z_err</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_z</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">)</span>
        <span class="c1"># ---------------------------</span>
        <span class="c1"># error propagation:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_resistivity_err</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_phase_err</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="k">for</span> <span class="n">idx_f</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">freq</span><span class="o">.</span><span class="n">shape</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">jj</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
                    <span class="n">abs_z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">5</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">freq</span><span class="p">[</span><span class="n">idx_f</span><span class="p">]</span> <span class="o">*</span> \
                                    <span class="bp">self</span><span class="o">.</span><span class="n">resistivity</span><span class="p">[</span><span class="n">idx_f</span><span class="p">,</span> <span class="n">ii</span><span class="p">,</span> <span class="n">jj</span><span class="p">])</span>
                    <span class="n">rel_error_res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">resistivity_err</span><span class="p">[</span><span class="n">idx_f</span><span class="p">,</span> <span class="n">ii</span><span class="p">,</span> <span class="n">jj</span><span class="p">]</span> <span class="o">/</span> \
                                    <span class="bp">self</span><span class="o">.</span><span class="n">resistivity</span><span class="p">[</span><span class="n">idx_f</span><span class="p">,</span> <span class="n">ii</span><span class="p">,</span> <span class="n">jj</span><span class="p">]</span>
                    <span class="c1"># relative error varies by a factor of 0.5, which is the</span>
                    <span class="c1"># exponent in the relation between them:</span>
                    <span class="n">abs_z_error</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">abs_z</span> <span class="o">*</span> <span class="n">rel_error_res</span>

                    <span class="bp">self</span><span class="o">.</span><span class="n">_z_err</span><span class="p">[</span><span class="n">idx_f</span><span class="p">,</span> <span class="n">ii</span><span class="p">,</span> <span class="n">jj</span><span class="p">]</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">MTcc</span><span class="o">.</span><span class="n">propagate_error_polar2rect</span><span class="p">(</span>
                        <span class="n">abs_z</span><span class="p">,</span>
                        <span class="n">abs_z_error</span><span class="p">,</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">phase</span><span class="p">[</span><span class="n">idx_f</span><span class="p">,</span> <span class="n">ii</span><span class="p">,</span> <span class="n">jj</span><span class="p">],</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">phase_err</span><span class="p">[</span><span class="n">idx_f</span><span class="p">,</span> <span class="n">ii</span><span class="p">,</span> <span class="n">jj</span><span class="p">]))</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">res_xx</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_resistivity</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">res_xy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_resistivity</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">res_yx</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_resistivity</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">res_yy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_resistivity</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">phase_xx</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_phase</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">phase_xy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_phase</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">phase_yx</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_phase</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">phase_yy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_phase</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">res_err_xx</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_resistivity_err</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">res_err_xy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_resistivity_err</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">res_err_yx</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_resistivity_err</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">res_err_yy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_resistivity_err</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">phase_err_xx</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_phase_err</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">phase_err_xy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_phase_err</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">phase_err_yx</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_phase_err</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">phase_err_yy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_phase_err</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>

    <span class="c1"># calculate determinant values</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_zdet</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">det</span><span class="p">(</span><span class="n">zz</span><span class="p">)</span> <span class="o">**</span> <span class="o">.</span><span class="mi">5</span> <span class="k">for</span> <span class="n">zz</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_z</span><span class="p">])</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_zdet_var</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_z_err</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="nb">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">det</span><span class="p">(</span><span class="n">zzv</span><span class="p">))</span> <span class="o">**</span> <span class="o">.</span><span class="mi">5</span> <span class="k">for</span> <span class="n">zzv</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_z_err</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_zdet</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">phase_det</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_zdet</span><span class="o">.</span><span class="n">imag</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_zdet</span><span class="o">.</span><span class="n">real</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">180</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">phase_det_err</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">arcsin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_zdet_var</span> <span class="o">/</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_zdet</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span><span class="mi">180</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">res_det</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="mf">0.2</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">freq</span><span class="p">)</span> <span class="o">*</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_zdet</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">res_det_err</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="mf">0.2</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">freq</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_zdet</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_zdet_var</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">res_det</span></div>


<span class="c1"># ==============================================================================</span>
<span class="c1"># Impedance Tensor Class</span>
<span class="c1"># ==============================================================================</span>
<div class="viewcode-block" id="Z"><a class="viewcode-back" href="../../../core.html#mtpy.core.z.Z">[docs]</a><span class="k">class</span> <span class="nc">Z</span><span class="p">(</span><span class="n">ResPhase</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Z class - generates an impedance tensor (Z) object.</span>

<span class="sd">    Z is a complex array of the form (n_freq, 2, 2),</span>
<span class="sd">    with indices in the following order:</span>

<span class="sd">        - Zxx: (0,0)</span>
<span class="sd">        - Zxy: (0,1)</span>
<span class="sd">        - Zyx: (1,0)</span>
<span class="sd">        - Zyy: (1,1)</span>

<span class="sd">    All errors are given as standard deviations (sqrt(VAR))</span>

<span class="sd">    :param z_array: array containing complex impedance values</span>
<span class="sd">    :type z_array: numpy.ndarray(n_freq, 2, 2)</span>


<span class="sd">    :param z_err_array: array containing error values (standard deviation)</span>
<span class="sd">                        of impedance tensor elements</span>
<span class="sd">    :type z_err_array: numpy.ndarray(n_freq, 2, 2)</span>

<span class="sd">    :param freq: array of frequency values corresponding to impedance tensor</span>
<span class="sd">                 elements.</span>
<span class="sd">    :type freq: np.ndarray(n_freq)</span>


<span class="sd">    =============== ===========================================================</span>
<span class="sd">    Attributes      Description</span>
<span class="sd">    =============== ===========================================================</span>
<span class="sd">    freq             array of frequencies corresponding to elements of z</span>
<span class="sd">    rotation_angle   angle of which data is rotated by</span>
<span class="sd">    z                impedance tensor</span>
<span class="sd">    z_err             estimated errors of impedance tensor</span>
<span class="sd">    resistivity      apparent resisitivity estimated from z in Ohm-m</span>
<span class="sd">    resistivity_err  apparent resisitivity error</span>
<span class="sd">    phase            impedance phase (deg)</span>
<span class="sd">    phase_err        error in impedance phase</span>
<span class="sd">    =============== ===========================================================</span>

<span class="sd">    =================== =======================================================</span>
<span class="sd">    Methods             Description</span>
<span class="sd">    =================== =======================================================</span>
<span class="sd">    det                  calculates determinant of z with errors</span>
<span class="sd">    invariants           calculates the invariants of z</span>
<span class="sd">    inverse              calculates the inverse of z</span>
<span class="sd">    remove_distortion    removes distortion given a distortion matrix</span>
<span class="sd">    remove_ss            removes static shift by assumin Z = S * Z_0</span>
<span class="sd">    norm                 calculates the norm of Z</span>
<span class="sd">    only1d               zeros diagonal components and computes</span>
<span class="sd">                         the absolute valued mean of the off-diagonal</span>
<span class="sd">                         components.</span>
<span class="sd">    only2d               zeros diagonal components</span>
<span class="sd">    res_phase            computes resistivity and phase</span>
<span class="sd">    rotate               rotates z positive clockwise, angle assumes</span>
<span class="sd">                         North is 0.</span>
<span class="sd">    set_res_phase        recalculates z and z_err, needs attribute freq</span>
<span class="sd">    skew                 calculates the invariant skew (off diagonal trace)</span>
<span class="sd">    trace                calculates the trace of z</span>
<span class="sd">    =================== =======================================================</span>

<span class="sd">    :Example: ::</span>

<span class="sd">        &gt;&gt;&gt; import mtpy.core.z as mtz</span>
<span class="sd">        &gt;&gt;&gt; import numpy as np</span>
<span class="sd">        &gt;&gt;&gt; z_test = np.array([[0+0j, 1+1j], [-1-1j, 0+0j]])</span>
<span class="sd">        &gt;&gt;&gt; z_object = mtz.Z(z_array=z_test, freq=[1])</span>
<span class="sd">        &gt;&gt;&gt; z_object.rotate(45)</span>
<span class="sd">        &gt;&gt;&gt; z_object.resistivity</span>


<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">z_array</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">z_err_array</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialise an instance of the Z class.</span>

<span class="sd">        :param z_array: array containing complex impedance values</span>
<span class="sd">        :type z_array: numpy.ndarray(n_freq, 2, 2)</span>

<span class="sd">        :param z_err_array: array containing error values (standard deviation)</span>
<span class="sd">                            of impedance tensor elements</span>
<span class="sd">        :type z_err_array: numpy.ndarray(n_freq, 2, 2)</span>

<span class="sd">        :param freq: array of frequency values corresponding to impedance</span>
<span class="sd">                     tensor elements.</span>
<span class="sd">        :type freq: np.ndarray(n_freq)</span>

<span class="sd">        Initialises the attributes with None</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">ResPhase</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_z</span> <span class="o">=</span> <span class="n">z_array</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_z_err</span> <span class="o">=</span> <span class="n">z_err_array</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_freq</span> <span class="o">=</span> <span class="n">freq</span>

        <span class="k">if</span> <span class="n">z_array</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">z_array</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">z_array</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">z_array</span><span class="o">.</span><span class="n">dtype</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;complex&#39;</span><span class="p">,</span> <span class="s1">&#39;float&#39;</span><span class="p">,</span> <span class="s1">&#39;int&#39;</span><span class="p">]:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="s1">&#39;complex&#39;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_z</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">z_array</span>

        <span class="k">if</span> <span class="n">z_err_array</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">z_err_array</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">z_err_array</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">z_err_array</span><span class="o">.</span><span class="n">dtype</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;complex&#39;</span><span class="p">,</span> <span class="s1">&#39;float&#39;</span><span class="p">,</span> <span class="s1">&#39;int&#39;</span><span class="p">]:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_z_err</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="s1">&#39;complex&#39;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_z_err</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">z_err_array</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">rotation_angle</span> <span class="o">=</span> <span class="mf">0.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_z</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rotation_angle</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_z</span><span class="p">)))</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_z</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">compute_resistivity_phase</span><span class="p">()</span>

    <span class="c1"># ---frequency-------------------------------------------------------------</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">freq</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Frequencies for each impedance tensor element</span>

<span class="sd">        Units are Hz.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_freq</span>

    <span class="nd">@freq</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">freq</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">freq_arr</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the array of freq.</span>

<span class="sd">        :param freq_arr: array of frequnecies (Hz)</span>
<span class="sd">        :type freq_arr: np.ndarray</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">freq_arr</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_freq</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">freq_arr</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">z</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_freq</span><span class="o">.</span><span class="n">size</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;length of freq list/array not correct&#39;</span>
                                      <span class="s1">&#39;(</span><span class="si">{0}</span><span class="s1"> instead of </span><span class="si">{1}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_freq</span><span class="o">.</span><span class="n">size</span><span class="p">,</span>
                                                                    <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">)))</span>
                    <span class="k">return</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">compute_resistivity_phase</span><span class="p">()</span>
                    <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                        <span class="nb">print</span> <span class="s1">&#39;Need to input frequency array&#39;</span>

    <span class="c1"># ----impedance tensor -----------------------------------------------------</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">z</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Impedance tensor</span>

<span class="sd">        np.ndarray(nfreq, 2, 2)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_z</span>

    <span class="nd">@z</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">z</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">z_array</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the attribute &#39;z&#39;.</span>


<span class="sd">        :param z_array: complex impedance tensor array</span>
<span class="sd">        :type z_array: np.ndarray(nfreq, 2, 2)</span>

<span class="sd">        Test for shape, but no test for consistency!</span>

<span class="sd">        Nulling the rotation_angle</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">z_array</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span> <span class="ow">and</span> <span class="n">z_array</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">z_array</span><span class="o">.</span><span class="n">dtype</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;complex&#39;</span><span class="p">,</span> <span class="s1">&#39;float&#39;</span><span class="p">,</span> <span class="s1">&#39;int&#39;</span><span class="p">]:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_z</span> <span class="o">=</span> <span class="n">z_array</span>
        <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">z_array</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">z_array</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">z_array</span><span class="o">.</span><span class="n">dtype</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;complex&#39;</span><span class="p">,</span> <span class="s1">&#39;float&#39;</span><span class="p">,</span> <span class="s1">&#39;int&#39;</span><span class="p">]:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="s1">&#39;complex&#39;</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_z</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">z_array</span>
            <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;provided Z array does not have correct dimensions- Z unchanged&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rotation_angle</span><span class="p">,</span> <span class="nb">float</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rotation_angle</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rotation_angle</span><span class="p">,</span>
                                            <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_z</span><span class="p">))</span>

        <span class="c1"># for consistency recalculate resistivity and phase</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_z</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_z_err</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">compute_resistivity_phase</span><span class="p">()</span>
            <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Need to input frequency array&#39;</span><span class="p">)</span>

    <span class="c1"># ----impedance error-----------------------------------------------------</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">z_err</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_z_err</span>

    <span class="nd">@z_err</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">z_err</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">z_err_array</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the attribute z_err</span>

<span class="sd">        :param z_err_array: error of impedance tensor array as standard</span>
<span class="sd">                            deviation</span>
<span class="sd">        :type z_err_array: np.ndarray(nfreq, 2, 2)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">z_err_array</span><span class="o">.</span><span class="n">shape</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="o">.</span><span class="n">shape</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;z_err_array shape </span><span class="si">{0}</span><span class="s1"> is not same shape as z </span><span class="si">{1}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">z_err_array</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_z_err</span> <span class="o">=</span> <span class="n">z_err_array</span>

        <span class="c1"># for consistency recalculate resistivity and phase</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_z_err</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_z</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">compute_resistivity_phase</span><span class="p">()</span>
            <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Need to input frequency array&#39;</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">inverse</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Return the inverse of Z.</span>

<span class="sd">            (no error propagtaion included yet)</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">z</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;z array is &quot;None&quot; - I cannot invert that&#39;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="n">inverse</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">idx_f</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">inverse</span><span class="p">)):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">inverse</span><span class="p">[</span><span class="n">idx_f</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">[</span><span class="n">idx_f</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]))</span><span class="o">.</span><span class="n">I</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">MTex</span><span class="o">.</span><span class="n">MTpyError_Z</span><span class="p">(</span><span class="s1">&#39;The </span><span class="si">{0}</span><span class="s1">ith impedance&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">idx_f</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> \
                                       <span class="s1">&#39;tensor cannot be inverted&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">inverse</span>

<div class="viewcode-block" id="Z.rotate"><a class="viewcode-back" href="../../../core.html#mtpy.core.z.Z.rotate">[docs]</a>    <span class="k">def</span> <span class="nf">rotate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">alpha</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Rotate Z array by angle alpha.</span>

<span class="sd">        Rotation angle must be given in degrees. All angles are referenced</span>
<span class="sd">        to geographic North, positive in clockwise direction.</span>
<span class="sd">        (Mathematically negative!)</span>

<span class="sd">        In non-rotated state, X refs to North and Y to East direction.</span>

<span class="sd">        Updates the attributes</span>
<span class="sd">            - *z*</span>
<span class="sd">            - *z_err*</span>
<span class="sd">            - *zrot*</span>
<span class="sd">            - *resistivity*</span>
<span class="sd">            - *phase*</span>
<span class="sd">            - *resistivity_err*</span>
<span class="sd">            - *phase_err*</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">z</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;Z array is &quot;None&quot; - I cannot rotate that&#39;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="c1"># check for iterable list/set of angles - if so, it must have length</span>
        <span class="c1"># 1 or same as len(tipper):</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">iterable</span><span class="p">(</span><span class="n">alpha</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">degreeangle</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">alpha</span> <span class="o">%</span> <span class="mi">360</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;&quot;Angle&quot; must be a valid number (in degrees)&#39;</span><span class="p">)</span>
                <span class="k">return</span>

            <span class="c1"># make an n long list of identical angles</span>
            <span class="n">lo_angles</span> <span class="o">=</span> <span class="p">[</span><span class="n">degreeangle</span> <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">alpha</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">degreeangle</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">alpha</span> <span class="o">%</span> <span class="mi">360</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;&quot;Angle&quot; must be a valid number (in degrees)&#39;</span><span class="p">)</span>
                    <span class="k">return</span>
                <span class="c1"># make an n long list of identical angles</span>
                <span class="n">lo_angles</span> <span class="o">=</span> <span class="p">[</span><span class="n">degreeangle</span> <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">lo_angles</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">ii</span> <span class="o">%</span> <span class="mi">360</span><span class="p">)</span> <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="n">alpha</span><span class="p">]</span>
                <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;&quot;Angles&quot; must be valid numbers (in degrees)&#39;</span><span class="p">)</span>
                    <span class="k">return</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">rotation_angle</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([(</span><span class="n">oldangle</span> <span class="o">+</span> <span class="n">lo_angles</span><span class="p">[</span><span class="n">ii</span><span class="p">])</span> <span class="o">%</span> <span class="mi">360</span>
                                        <span class="k">for</span> <span class="n">ii</span><span class="p">,</span> <span class="n">oldangle</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rotation_angle</span><span class="p">)])</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">lo_angles</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;Wrong number of &quot;angles&quot; - I need </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">)))</span>
            <span class="c1"># self.rotation_angle = 0.</span>
            <span class="k">return</span>

        <span class="n">z_rot</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">)</span>
        <span class="n">z_err_rot</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">z_err</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">idx_freq</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">)):</span>

            <span class="n">angle</span> <span class="o">=</span> <span class="n">lo_angles</span><span class="p">[</span><span class="n">idx_freq</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">angle</span><span class="p">):</span>
                <span class="n">angle</span> <span class="o">=</span> <span class="mf">0.</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">z_err</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">z_rot</span><span class="p">[</span><span class="n">idx_freq</span><span class="p">],</span> <span class="n">z_err_rot</span><span class="p">[</span><span class="n">idx_freq</span><span class="p">]</span> <span class="o">=</span> \
                    <span class="n">MTcc</span><span class="o">.</span><span class="n">rotatematrix_incl_errors</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">[</span><span class="n">idx_freq</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:],</span>
                                                  <span class="n">angle</span><span class="p">,</span>
                                                  <span class="bp">self</span><span class="o">.</span><span class="n">z_err</span><span class="p">[</span><span class="n">idx_freq</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">z_rot</span><span class="p">[</span><span class="n">idx_freq</span><span class="p">],</span> <span class="n">z_err_rot</span> <span class="o">=</span> \
                    <span class="n">MTcc</span><span class="o">.</span><span class="n">rotatematrix_incl_errors</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">[</span><span class="n">idx_freq</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:],</span>
                                                  <span class="n">angle</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">z</span> <span class="o">=</span> <span class="n">z_rot</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">z_err</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">z_err</span> <span class="o">=</span> <span class="n">z_err_rot</span>

        <span class="c1"># for consistency recalculate resistivity and phase</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">compute_resistivity_phase</span><span class="p">()</span></div>

<div class="viewcode-block" id="Z.remove_ss"><a class="viewcode-back" href="../../../core.html#mtpy.core.z.Z.remove_ss">[docs]</a>    <span class="k">def</span> <span class="nf">remove_ss</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reduce_res_factor_x</span><span class="o">=</span><span class="mf">1.</span><span class="p">,</span> <span class="n">reduce_res_factor_y</span><span class="o">=</span><span class="mf">1.</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Remove the static shift by providing the respective correction factors</span>
<span class="sd">        for the resistivity in the x and y components.</span>
<span class="sd">        (Factors can be determined by using the &quot;Analysis&quot; module for the</span>
<span class="sd">        impedance tensor)</span>

<span class="sd">        Assume the original observed tensor Z is built by a static shift S</span>
<span class="sd">        and an unperturbated &quot;correct&quot; Z0 :</span>

<span class="sd">             * Z = S * Z0</span>

<span class="sd">        therefore the correct Z will be :</span>
<span class="sd">            * Z0 = S^(-1) * Z</span>


<span class="sd">        :param reduce_res_factor_x: static shift factor to be applied to x</span>
<span class="sd">                                    components (ie z[:, 0, :]).  This is</span>
<span class="sd">                                    assumed to be in resistivity scale</span>
<span class="sd">        :type reduce_res_factor_x: float or iterable list or array</span>

<span class="sd">        :param reduce_res_factor_y: static shift factor to be applied to y</span>
<span class="sd">                                    components (ie z[:, 1, :]).  This is</span>
<span class="sd">                                    assumed to be in resistivity scale</span>
<span class="sd">        :type reduce_res_factor_y: float or iterable list or array</span>

<span class="sd">        :returns: static shift matrix,</span>
<span class="sd">        :rtype: np.ndarray ((2, 2))</span>

<span class="sd">        :returns: corrected Z</span>
<span class="sd">        :rtype: mtpy.core.z.Z</span>

<span class="sd">        .. note:: The factors are in resistivity scale, so the</span>
<span class="sd">                  entries of  the matrix &quot;S&quot; need to be given by their</span>
<span class="sd">                  square-roots!</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># check for iterable list/set of reduce_res_factor_x - if so, it must</span>
        <span class="c1"># have length 1 or same as len(z):</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">iterable</span><span class="p">(</span><span class="n">reduce_res_factor_x</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">x_factor</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">reduce_res_factor_x</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;reduce_res_factor_x must be a valid numbers&#39;</span><span class="p">)</span>
                <span class="k">return</span>

            <span class="n">lo_x_factors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">x_factor</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">))</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">reduce_res_factor_x</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">x_factor</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">reduce_res_factor_x</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;reduce_res_factor_x must be a valid numbers&#39;</span><span class="p">)</span>
                <span class="k">return</span>
            <span class="n">lo_x_factors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">x_factor</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">lo_x_factors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">x_factor</span><span class="p">,</span>
                                         <span class="nb">len</span><span class="p">(</span><span class="n">reduce_res_factor_x</span><span class="p">))</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;&quot;reduce_res_factor_x&quot; must be valid numbers&#39;</span><span class="p">)</span>
                <span class="k">return</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">lo_x_factors</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Wrong number Number of reduce_res_factor_x - need </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">)))</span>
            <span class="k">return</span>

        <span class="c1"># check for iterable list/set of reduce_res_factor_y - if so,</span>
        <span class="c1"># it must have length 1 or same as len(z):</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">iterable</span><span class="p">(</span><span class="n">reduce_res_factor_y</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">y_factor</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">reduce_res_factor_y</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;&quot;reduce_res_factor_y&quot; must be a valid numbers&#39;</span><span class="p">)</span>
                <span class="k">return</span>

            <span class="n">lo_y_factors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">y_factor</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">))</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">reduce_res_factor_y</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">y_factor</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">reduce_res_factor_y</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;&quot;reduce_res_factor_y&quot; must be a valid numbers&#39;</span><span class="p">)</span>
                <span class="k">return</span>
            <span class="n">lo_y_factors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">y_factor</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">lo_y_factors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">y_factor</span><span class="p">,</span>
                                         <span class="nb">len</span><span class="p">(</span><span class="n">reduce_res_factor_y</span><span class="p">))</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;&quot;reduce_res_factor_y&quot; must be valid numbers&#39;</span><span class="p">)</span>
                <span class="k">return</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">lo_y_factors</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Wrong number Number of &quot;reduce_res_factor_y&quot;&#39;</span> <span class="o">+</span> \
                               <span class="s1">&#39;- need </span><span class="si">{0}</span><span class="s1"> &#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">)))</span>
            <span class="k">return</span>

        <span class="n">z_corrected</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">)</span>
        <span class="n">static_shift</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">),</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>

        <span class="k">for</span> <span class="n">idx_f</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">)):</span>
            <span class="c1"># correct for x-direction</span>
            <span class="n">z_corrected</span><span class="p">[</span><span class="n">idx_f</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">[</span><span class="n">idx_f</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">:]</span> <span class="o">/</span> \
                                       <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">lo_x_factors</span><span class="p">[</span><span class="n">idx_f</span><span class="p">])</span>
            <span class="c1"># correct for y-direction</span>
            <span class="n">z_corrected</span><span class="p">[</span><span class="n">idx_f</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">[</span><span class="n">idx_f</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">:]</span> <span class="o">/</span> \
                                       <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">lo_y_factors</span><span class="p">[</span><span class="n">idx_f</span><span class="p">])</span>
            <span class="c1"># make static shift array</span>
            <span class="n">static_shift</span><span class="p">[</span><span class="n">idx_f</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">lo_x_factors</span><span class="p">[</span><span class="n">idx_f</span><span class="p">])</span>
            <span class="n">static_shift</span><span class="p">[</span><span class="n">idx_f</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">lo_y_factors</span><span class="p">[</span><span class="n">idx_f</span><span class="p">])</span>

        <span class="k">return</span> <span class="n">static_shift</span><span class="p">,</span> <span class="n">z_corrected</span></div>

<div class="viewcode-block" id="Z.remove_distortion"><a class="viewcode-back" href="../../../core.html#mtpy.core.z.Z.remove_distortion">[docs]</a>    <span class="k">def</span> <span class="nf">remove_distortion</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">distortion_tensor</span><span class="p">,</span> <span class="n">distortion_err_tensor</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Remove distortion D form an observed impedance tensor Z to obtain</span>
<span class="sd">        the uperturbed &quot;correct&quot; Z0:</span>
<span class="sd">        Z = D * Z0</span>

<span class="sd">        Propagation of errors/uncertainties included</span>


<span class="sd">        :param distortion_tensor: real distortion tensor as a 2x2</span>
<span class="sd">        :type distortion_tensor: np.ndarray(2, 2, dtype=real)</span>


<span class="sd">        :param distortion_err_tensor: default is None</span>
<span class="sd">        :type distortion_err_tensor: np.ndarray(2, 2, dtype=real),</span>

<span class="sd">			:returns: input distortion tensor</span>
<span class="sd">        :rtype: np.ndarray(2, 2, dtype=&#39;real&#39;)</span>

<span class="sd">			:returns: impedance tensor with distorion removed</span>
<span class="sd">        :rtype: np.ndarray(num_freq, 2, 2, dtype=&#39;complex&#39;)</span>


<span class="sd">			:returns: impedance tensor error after distortion is removed</span>
<span class="sd">        :rtype: np.ndarray(num_freq, 2, 2, dtype=&#39;complex&#39;)</span>


<span class="sd">    		:Example: ::</span>

<span class="sd">    			&gt;&gt;&gt; import mtpy.core.z as mtz</span>
<span class="sd">    			&gt;&gt;&gt; distortion = np.array([[1.2, .5],[.35, 2.1]])</span>
<span class="sd">    			&gt;&gt;&gt; d, new_z, new_z_err = z_obj.remove_distortion(distortion)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">distortion_err_tensor</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">distortion_err_tensor</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">distortion_tensor</span><span class="p">)</span>
        <span class="c1"># for all freq, calculate D.Inverse, then obtain Z0 = D.I * Z</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">distortion_tensor</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span> <span class="ow">and</span> \
                    <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">distortion_err_tensor</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Shape not the same&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">distortion_tensor</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span> <span class="ow">or</span> \
                            <span class="nb">len</span><span class="p">(</span><span class="n">distortion_err_tensor</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Distortion is not time-dependent - take only first&#39;</span> <span class="o">+</span> \
                                  <span class="s1">&#39;of given distortion tensors&#39;</span><span class="p">)</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">distortion_tensor</span> <span class="o">=</span> <span class="n">distortion_tensor</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">distortion_err_tensor</span> <span class="o">=</span> <span class="n">distortion_err_tensor</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;distortion tensor the wrong shape&#39;</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">distortion_tensor</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span> <span class="ow">and</span> \
                    <span class="p">(</span><span class="n">distortion_err_tensor</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Shape not the same&#39;</span><span class="p">)</span>

            <span class="n">distortion_tensor</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">distortion_tensor</span><span class="p">))</span>

        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">MTex</span><span class="o">.</span><span class="n">MTpyError_Z</span><span class="p">(</span><span class="s1">&#39;The array provided is not a proper&#39;</span> <span class="o">+</span> \
                                   <span class="s1">&#39;distortion tensor&#39;</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">DI</span> <span class="o">=</span> <span class="n">distortion_tensor</span><span class="o">.</span><span class="n">I</span>
        <span class="k">except</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">LinAlgError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">MTex</span><span class="o">.</span><span class="n">MTpyError_Z</span><span class="p">(</span><span class="s1">&#39;The provided distortion tensor is&#39;</span> <span class="o">+</span> \
                                   <span class="s1">&#39;singular - I cannot invert that!&#39;</span><span class="p">)</span>

        <span class="c1"># propagation of errors (using 1-norm) - step 1 - inversion of D:</span>
        <span class="n">DI_err</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">distortion_err_tensor</span><span class="p">)</span>

        <span class="c1"># todo :include error on  determinant!!</span>
        <span class="c1"># D_det = np.linalg.det(distortion_tensor)</span>

        <span class="n">dummy</span><span class="p">,</span> <span class="n">DI_err</span> <span class="o">=</span> <span class="n">MTcc</span><span class="o">.</span><span class="n">invertmatrix_incl_errors</span><span class="p">(</span><span class="n">distortion_tensor</span><span class="p">,</span>
                                                      <span class="n">distortion_err_tensor</span><span class="p">)</span>

        <span class="c1"># propagation of errors - step 2 - product of D.inverse and Z;</span>
        <span class="c1"># D.I * Z, making it 4 summands for each component:</span>
        <span class="n">z_corrected</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">)</span>
        <span class="n">z_corrected_err</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">z_err</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">idx_f</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">)):</span>
            <span class="n">z_corrected</span><span class="p">[</span><span class="n">idx_f</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">DI</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">[</span><span class="n">idx_f</span><span class="p">])))</span>
            <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">jj</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
                    <span class="n">z_corrected_err</span><span class="p">[</span><span class="n">idx_f</span><span class="p">,</span> <span class="n">ii</span><span class="p">,</span> <span class="n">jj</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span>
                        <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">DI_err</span><span class="p">[</span><span class="n">ii</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">*</span> \
                                  <span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">[</span><span class="n">idx_f</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">jj</span><span class="p">],</span> \
                                  <span class="n">DI</span><span class="p">[</span><span class="n">ii</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">*</span> \
                                  <span class="bp">self</span><span class="o">.</span><span class="n">z_err</span><span class="p">[</span><span class="n">idx_f</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">jj</span><span class="p">],</span> \
                                  <span class="n">DI_err</span><span class="p">[</span><span class="n">ii</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> \
                                  <span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">[</span><span class="n">idx_f</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">jj</span><span class="p">],</span> \
                                  <span class="n">DI</span><span class="p">[</span><span class="n">ii</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> \
                                  <span class="bp">self</span><span class="o">.</span><span class="n">z_err</span><span class="p">[</span><span class="n">idx_f</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">jj</span><span class="p">]])))</span>

        <span class="k">return</span> <span class="n">distortion_tensor</span><span class="p">,</span> <span class="n">z_corrected</span><span class="p">,</span> <span class="n">z_corrected_err</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">only_1d</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return Z in 1D form.</span>

<span class="sd">        If Z is not 1D per se, the diagonal elements are set to zero,</span>
<span class="sd">        the off-diagonal elements keep their signs, but their absolute</span>
<span class="sd">        is set to the mean of the original Z off-diagonal absolutes.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">z1d</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">z1d</span><span class="p">)):</span>
            <span class="n">z1d</span><span class="p">[</span><span class="n">ii</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">z1d</span><span class="p">[</span><span class="n">ii</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">sign01</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">z1d</span><span class="p">[</span><span class="n">ii</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
            <span class="n">sign10</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">z1d</span><span class="p">[</span><span class="n">ii</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
            <span class="n">mean1d</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">z1d</span><span class="p">[</span><span class="n">ii</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">z1d</span><span class="p">[</span><span class="n">ii</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
            <span class="n">z1d</span><span class="p">[</span><span class="n">ii</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">sign01</span> <span class="o">*</span> <span class="n">mean1d</span>
            <span class="n">z1d</span><span class="p">[</span><span class="n">ii</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">sign10</span> <span class="o">*</span> <span class="n">mean1d</span>

        <span class="k">return</span> <span class="n">z1d</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">only_2d</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return Z in 2D form.</span>

<span class="sd">        If Z is not 2D per se, the diagonal elements are set to zero.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">z2d</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">z2d</span><span class="p">)):</span>
            <span class="n">z2d</span><span class="p">[</span><span class="n">ii</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">z2d</span><span class="p">[</span><span class="n">ii</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">return</span> <span class="n">z2d</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">trace</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the trace of Z</span>

<span class="sd">        :returns: Trace(z)</span>
<span class="sd">        :rtype: np.ndarray(nfreq, 2, 2)</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">tr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="n">ii</span><span class="p">)</span> <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">])</span>

        <span class="k">return</span> <span class="n">tr</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">trace_err</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the trace of Z</span>

<span class="sd">        :returns: Trace(z)</span>
<span class="sd">        :rtype: np.ndarray(nfreq, 2, 2)</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">tr_err</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">z_err</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">tr_err</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">trace</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">)</span>
            <span class="n">tr_err</span><span class="p">[:]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">z_err</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">z_err</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">tr_err</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">skew</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the skew of Z as defined by Z[0, 1] + Z[1, 0]</span>

<span class="sd">        .. note:: This is not the MT skew, but simply the linear algebra skew</span>


<span class="sd">        :returns: skew</span>
<span class="sd">        :rtype: np.ndarray(nfreq, 2, 2)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">skew</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">ii</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">ii</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">])</span>

        <span class="k">return</span> <span class="n">skew</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">skew_err</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the skew error of Z as defined by Z_err[0, 1] + Z_err[1, 0]</span>

<span class="sd">        .. note:: This is not the MT skew, but simply the linear algebra skew</span>

<span class="sd">        :returns: skew_err</span>
<span class="sd">        :rtype: np.ndarray(nfreq, 2, 2)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">skew_err</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">z_err</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">skew_err</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">skew</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">)</span>
            <span class="n">skew_err</span><span class="p">[:]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">z_err</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">z_err</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">skew_err</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">det</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the determinant of Z</span>

<span class="sd">        :returns: det_Z</span>
<span class="sd">        :rtype: np.ndarray(nfreq)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">det_Z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">det</span><span class="p">(</span><span class="n">ii</span><span class="p">)</span> <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">])</span>

        <span class="k">return</span> <span class="n">det_Z</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">det_err</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the determinant of Z error</span>

<span class="sd">        :returns: det_Z_err</span>
<span class="sd">        :rtype: np.ndarray(nfreq)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">det_Z_err</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">z_err</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">det_Z_err</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">det</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">)</span>
            <span class="c1"># components of the impedance tensor are not independent variables</span>
            <span class="c1"># so can&#39;t use standard error propagation</span>
            <span class="c1"># calculate manually:</span>
            <span class="c1"># difference of determinant of z + z_err and z - z_err then divide by 2</span>
            <span class="n">det_Z_err</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">det</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">z</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">z_err</span><span class="p">)</span> <span class="o">-</span> \
                                  <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">det</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">z</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">z_err</span><span class="p">))</span> <span class="o">/</span> <span class="mf">2.</span>
        <span class="c1"># det_Z_err[:] = np.abs(self.z[:, 1, 1] * self.z_err[:, 0, 0]) +\</span>
        <span class="c1">#                           np.abs(self.z[:, 0, 0] * self.z_err[:, 1, 1]) +\</span>
        <span class="c1">#                           np.abs(self.z[:, 0, 1] * self.z_err[:, 1, 0]) +\</span>
        <span class="c1">#                           np.abs(self.z[:, 1, 0] * self.z_err[:, 0, 1])</span>

        <span class="k">return</span> <span class="n">det_Z_err</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">norm</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the 2-/Frobenius-norm of Z</span>

<span class="sd">        :returns: norm</span>
<span class="sd">        :rtype: np.ndarray(nfreq)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">norm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">ii</span><span class="p">)</span> <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">])</span>

        <span class="k">return</span> <span class="n">norm</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">norm_err</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the 2-/Frobenius-norm of Z  error</span>

<span class="sd">        :returns: norm_err</span>
<span class="sd">        :rtype: np.ndarray(nfreq)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">norm_err</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">z_err</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">norm_err</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">norm</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">z_tmp</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">):</span>
                <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">norm</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
                <span class="n">error_matrix</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">z_err</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
                <span class="n">radicand</span> <span class="o">=</span> <span class="mf">0.</span>
                <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
                    <span class="k">for</span> <span class="n">jj</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
                        <span class="n">radicand</span> <span class="o">+=</span> <span class="p">(</span><span class="n">error_matrix</span><span class="p">[</span><span class="n">ii</span><span class="p">,</span> <span class="n">jj</span><span class="p">]</span> <span class="o">*</span> \
                                     <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">z_tmp</span><span class="p">[</span><span class="n">ii</span><span class="p">,</span> <span class="n">jj</span><span class="p">]))</span> <span class="o">**</span> <span class="mi">2</span>
                        <span class="n">radicand</span> <span class="o">+=</span> <span class="p">(</span><span class="n">error_matrix</span><span class="p">[</span><span class="n">ii</span><span class="p">,</span> <span class="n">jj</span><span class="p">]</span> <span class="o">*</span> \
                                     <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">z_tmp</span><span class="p">[</span><span class="n">ii</span><span class="p">,</span> <span class="n">jj</span><span class="p">]))</span> <span class="o">**</span> <span class="mi">2</span>

                <span class="n">norm_err</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.</span> <span class="o">/</span> <span class="n">value</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">radicand</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">norm_err</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">invariants</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return a dictionary of Z-invariants.</span>

<span class="sd">        Contains</span>
<span class="sd">    		-----------</span>
<span class="sd">    			* z1</span>
<span class="sd">    			* det</span>
<span class="sd">    			* det_real</span>
<span class="sd">    			* det_imag</span>
<span class="sd">    			* trace</span>
<span class="sd">    			* skew</span>
<span class="sd">    			* norm</span>
<span class="sd">    			* lambda_plus/minus,</span>
<span class="sd">    			* sigma_plus/minus</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">invariants_dict</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="n">z1</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span> <span class="o">/</span> <span class="mf">2.</span>
        <span class="n">invariants_dict</span><span class="p">[</span><span class="s1">&#39;z1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">z1</span>

        <span class="n">invariants_dict</span><span class="p">[</span><span class="s1">&#39;det&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">det</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">det_real</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">det</span><span class="p">(</span><span class="n">ii</span><span class="p">)</span> <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">)])</span>
        <span class="n">invariants_dict</span><span class="p">[</span><span class="s1">&#39;det_real&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">det_real</span>

        <span class="n">det_imag</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">det</span><span class="p">(</span><span class="n">ii</span><span class="p">)</span> <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">)])</span>
        <span class="n">invariants_dict</span><span class="p">[</span><span class="s1">&#39;det_imag&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">det_imag</span>

        <span class="n">invariants_dict</span><span class="p">[</span><span class="s1">&#39;trace&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">trace</span>

        <span class="n">invariants_dict</span><span class="p">[</span><span class="s1">&#39;skew&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">skew</span>

        <span class="n">invariants_dict</span><span class="p">[</span><span class="s1">&#39;norm&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">norm</span>

        <span class="n">invariants_dict</span><span class="p">[</span><span class="s1">&#39;lambda_plus&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">z1</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">z1</span> <span class="o">*</span> <span class="n">z1</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">det</span><span class="p">)</span>

        <span class="n">invariants_dict</span><span class="p">[</span><span class="s1">&#39;lambda_minus&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">z1</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">z1</span> <span class="o">*</span> <span class="n">z1</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">det</span><span class="p">)</span>

        <span class="n">invariants_dict</span><span class="p">[</span><span class="s1">&#39;sigma_plus&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">norm</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> \
                                        <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">0.25</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">norm</span> <span class="o">**</span> <span class="mi">4</span><span class="p">)</span> <span class="o">+</span> \
                                        <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">det</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>

        <span class="n">invariants_dict</span><span class="p">[</span><span class="s1">&#39;sigma_minus&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">norm</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">-</span> \
                                         <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">0.25</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">norm</span> <span class="o">**</span> <span class="mi">4</span><span class="p">)</span> <span class="o">+</span> \
                                         <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">det</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">invariants_dict</span></div>


<span class="c1"># ==============================================================================</span>
<span class="c1"># errors</span>
<span class="c1"># ==============================================================================</span>
<div class="viewcode-block" id="MT_Z_Error"><a class="viewcode-back" href="../../../core.html#mtpy.core.z.MT_Z_Error">[docs]</a><span class="k">class</span> <span class="nc">MT_Z_Error</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="k">pass</span></div>


<span class="c1"># ======================================================================</span>
<span class="c1">#                               TIPPER</span>
<span class="c1"># ======================================================================</span>

<div class="viewcode-block" id="Tipper"><a class="viewcode-back" href="../../../core.html#mtpy.core.z.Tipper">[docs]</a><span class="k">class</span> <span class="nc">Tipper</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Tipper class --&gt; generates a Tipper-object.</span>

<span class="sd">    Errors are given as standard deviations (sqrt(VAR))</span>

<span class="sd">    :param tipper_array: tipper array in the shape of [Tx, Ty]</span>
<span class="sd">                         *default* is None</span>
<span class="sd">    :type tipper_array: np.ndarray((nf, 1, 2), dtype=&#39;complex&#39;)</span>


<span class="sd">    :param tipper_err_array: array of estimated tipper errors</span>
<span class="sd">                             in the shape of [Tx, Ty].</span>
<span class="sd">                             Must be the same shape as tipper_array.</span>
<span class="sd">                             *default* is None</span>
<span class="sd">    :type tipper_err_array: np.ndarray((nf, 1, 2))</span>


<span class="sd">    :param freq: array of frequencies corresponding to the tipper elements.</span>
<span class="sd">                 Must be same length as tipper_array.</span>
<span class="sd">                 *default* is None</span>
<span class="sd">    :type freq: np.ndarray(nf)</span>


<span class="sd">    =============== ===========================================================</span>
<span class="sd">    Attributes      Description</span>
<span class="sd">    =============== ===========================================================</span>
<span class="sd">    freq            array of frequencies corresponding to elements of z</span>
<span class="sd">    rotation_angle  angle of which data is rotated by</span>

<span class="sd">    tipper          tipper array</span>
<span class="sd">    tipper_err       tipper error array</span>
<span class="sd">    =============== ===========================================================</span>

<span class="sd">    =============== ===========================================================</span>
<span class="sd">    Methods         Description</span>
<span class="sd">    =============== ===========================================================</span>
<span class="sd">    mag_direction   computes magnitude and direction of real and imaginary</span>
<span class="sd">                    induction arrows.</span>
<span class="sd">    amp_phase       computes amplitude and phase of Tx and Ty.</span>
<span class="sd">    rotate          rotates the data by the given angle</span>
<span class="sd">    =============== ===========================================================</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tipper_array</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">tipper_err_array</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">freq</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        initialize</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_tipper</span> <span class="o">=</span> <span class="n">tipper_array</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tipper_err</span> <span class="o">=</span> <span class="n">tipper_err_array</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_freq</span> <span class="o">=</span> <span class="n">freq</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">rotation_angle</span> <span class="o">=</span> <span class="mf">0.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tipper</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rotation_angle</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tipper</span><span class="p">)))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_amplitude</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_amplitude_err</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_phase</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_phase_err</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_mag_real</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_mag_imag</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_angle_real</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_angle_imag</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_mag_err</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_angle_err</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tipper</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_freq</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">compute_amp_phase</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">compute_mag_direction</span><span class="p">()</span>

    <span class="c1"># ==========================================================================</span>
    <span class="c1"># Define get/set and properties</span>
    <span class="c1"># ==========================================================================</span>
    <span class="c1"># ----freq----------------------------------------------------------</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">freq</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_freq</span>

    <span class="nd">@freq</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">freq</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">freq_arr</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the array of freq.</span>

<span class="sd">        :param freq_arr: array of frequnecies (Hz)</span>
<span class="sd">        :type freq_arr: np.ndarray(num_frequencies)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">freq_arr</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_freq</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">freq_arr</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_freq</span><span class="o">.</span><span class="n">size</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tipper</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;length of freq list/array not correct&#39;</span> <span class="o">+</span> \
                              <span class="s1">&#39; (</span><span class="si">%i</span><span class="s1">i instead of </span><span class="si">%i</span><span class="s1">i)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_freq</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tipper</span><span class="p">)))</span>
            <span class="k">return</span>

        <span class="c1"># for consistency recalculate amplitude and phase</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">compute_amp_phase</span><span class="p">()</span>

    <span class="c1"># ---tipper--------------------------------------------------------------</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">tipper</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tipper</span>

    <span class="nd">@tipper</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">tipper</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tipper_array</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the attribute *tipper*</span>

<span class="sd">        :param tipper_array: tipper array in the shape of [Tx, Ty]</span>
<span class="sd">                             *default* is None</span>
<span class="sd">        :type tipper_array: np.ndarray((nf, 1, 2), dtype=&#39;complex&#39;)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># check to see if the new tipper array is the same shape as the old</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tipper</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tipper</span><span class="o">.</span><span class="n">shape</span> <span class="o">!=</span> <span class="n">tipper_array</span><span class="o">.</span><span class="n">shape</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">MT_Z_Error</span><span class="p">(</span><span class="s1">&#39;Shape of new &quot;tipper&quot; array does not match old&#39;</span> <span class="o">+</span> \
                             <span class="s1">&#39;new shape </span><span class="si">{0}</span><span class="s1"> != old shape </span><span class="si">{1}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">tipper_array</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span>
                                                                     <span class="bp">self</span><span class="o">.</span><span class="n">_tipper</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">+</span> \
                             <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">***Make new Tipper object***&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">tipper_array</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">tipper_array</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span> <span class="ow">and</span> <span class="n">tipper_array</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">tipper_array</span><span class="o">.</span><span class="n">dtype</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;complex&#39;</span><span class="p">,</span> <span class="s1">&#39;float&#39;</span><span class="p">,</span> <span class="s1">&#39;int&#39;</span><span class="p">]:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_tipper</span> <span class="o">=</span> <span class="n">tipper_array</span>

        <span class="c1"># neeed to set the rotation angle such that it is an array</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rotation_angle</span> <span class="ow">is</span> <span class="nb">float</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rotation_angle</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rotation_angle</span><span class="p">,</span>
                                            <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_tipper</span><span class="p">))</span>

            <span class="c1"># for consistency recalculate mag and angle</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">compute_mag_direction</span><span class="p">()</span>

        <span class="c1"># for consistency recalculate amplitude and phase</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">compute_amp_phase</span><span class="p">()</span>

    <span class="c1"># ----tipper error---------------------------------------------------------</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">tipper_err</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tipper_err</span>

    <span class="nd">@tipper_err</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">tipper_err</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tipper_err_array</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the attribute *tipper_err*.</span>

<span class="sd">        :param tipper_err_array: array of estimated tipper errors</span>
<span class="sd">                                 in the shape of [Tx, Ty].</span>
<span class="sd">                                 Must be the same shape as tipper_array.</span>
<span class="sd">                                 *default* is None</span>
<span class="sd">        :type tipper_err_array: np.ndarray((nf, 1, 2))</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tipper_err</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> \
                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_tipper_err</span><span class="o">.</span><span class="n">shape</span> <span class="o">!=</span> <span class="n">tipper_err_array</span><span class="o">.</span><span class="n">shape</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">MT_Z_Error</span><span class="p">(</span><span class="s1">&#39;Shape of new &quot;tipper_err&quot; array does not match old&#39;</span> <span class="o">+</span> \
                             <span class="s1">&#39;new shape </span><span class="si">{0}</span><span class="s1"> != old shape </span><span class="si">{1}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">tipper_err_array</span><span class="o">.</span><span class="n">shape</span><span class="p">),</span>
                             <span class="bp">self</span><span class="o">.</span><span class="n">_tipper_err</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

        <span class="c1"># make sure the input array is of required shape</span>
        <span class="k">if</span> <span class="n">tipper_err_array</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">tipper_err_array</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span> <span class="ow">and</span> \
                            <span class="n">tipper_err_array</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">tipper_err_array</span><span class="o">.</span><span class="n">dtype</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;float&#39;</span><span class="p">,</span> <span class="s1">&#39;int&#39;</span><span class="p">]:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_tipper_err</span> <span class="o">=</span> <span class="n">tipper_err_array</span>

                    <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tipper_err</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tipper</span><span class="o">.</span><span class="n">shape</span>

        <span class="c1"># for consistency recalculate mag and angle</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">compute_mag_direction</span><span class="p">()</span>

        <span class="c1"># for consistency recalculate amplitude and phase</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">compute_amp_phase</span><span class="p">()</span>

    <span class="c1"># ----amplitude and phase</span>
<div class="viewcode-block" id="Tipper.compute_amp_phase"><a class="viewcode-back" href="../../../core.html#mtpy.core.z.Tipper.compute_amp_phase">[docs]</a>    <span class="k">def</span> <span class="nf">compute_amp_phase</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets attributes:</span>
<span class="sd">    			* *amplitude*</span>
<span class="sd">    			* *phase*</span>
<span class="sd">    			* *amplitude_err*</span>
<span class="sd">    			* *phase_err*</span>

<span class="sd">        values for resistivity are in in Ohm m and phase in degrees.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tipper</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># logging.error( &#39;tipper array is None - cannot calculate rho/phi&#39;)</span>
            <span class="c1"># print &#39;tipper array is None - cannot calculate rho/phi&#39;</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_amplitude_err</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_phase_err</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tipper_err</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_amplitude_err</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tipper_err</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_phase_err</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tipper_err</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_amplitude</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tipper</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_phase</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">rad2deg</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">angle</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tipper</span><span class="p">))</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tipper_err</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">idx_f</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tipper</span><span class="p">)):</span>
                <span class="k">for</span> <span class="n">jj</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tipper_err</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tipper</span><span class="p">)</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">MaskedArray</span><span class="p">:</span>
                            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tipper</span><span class="o">.</span><span class="n">mask</span><span class="p">[</span><span class="n">idx_f</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">jj</span><span class="p">]:</span>
                                <span class="k">continue</span>
                        <span class="n">r_err</span><span class="p">,</span> <span class="n">phi_err</span> <span class="o">=</span> <span class="n">MTcc</span><span class="o">.</span><span class="n">propagate_error_rect2polar</span><span class="p">(</span>
                            <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tipper</span><span class="p">[</span><span class="n">idx_f</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">jj</span><span class="p">]),</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">tipper_err</span><span class="p">[</span><span class="n">idx_f</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">jj</span><span class="p">],</span>
                            <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tipper</span><span class="p">[</span><span class="n">idx_f</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">jj</span><span class="p">]),</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">tipper_err</span><span class="p">[</span><span class="n">idx_f</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">jj</span><span class="p">])</span>

                        <span class="bp">self</span><span class="o">.</span><span class="n">amplitude_err</span><span class="p">[</span><span class="n">idx_f</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">jj</span><span class="p">]</span> <span class="o">=</span> <span class="n">r_err</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_phase_err</span><span class="p">[</span><span class="n">idx_f</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">jj</span><span class="p">]</span> <span class="o">=</span> <span class="n">phi_err</span></div>

<div class="viewcode-block" id="Tipper.set_amp_phase"><a class="viewcode-back" href="../../../core.html#mtpy.core.z.Tipper.set_amp_phase">[docs]</a>    <span class="k">def</span> <span class="nf">set_amp_phase</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">r_array</span><span class="p">,</span> <span class="n">phi_array</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set values for amplitude(r) and argument (phi - in degrees).</span>

<span class="sd">        Updates the attributes:</span>
<span class="sd">    			* tipper</span>
<span class="sd">    			* tipper_err</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tipper</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>

            <span class="n">tipper_new</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tipper</span><span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tipper</span><span class="o">.</span><span class="n">shape</span> <span class="o">!=</span> <span class="n">r_array</span><span class="o">.</span><span class="n">shape</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Error - shape of &quot;r&quot; array does not match shape of &#39;</span> <span class="o">+</span> \
                                   <span class="s1">&#39;tipper array: </span><span class="si">%s</span><span class="s1"> ; </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">r_array</span><span class="o">.</span><span class="n">shape</span><span class="p">),</span>
                                                              <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tipper</span><span class="o">.</span><span class="n">shape</span><span class="p">)))</span>
                <span class="k">return</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tipper</span><span class="o">.</span><span class="n">shape</span> <span class="o">!=</span> <span class="n">phi_array</span><span class="o">.</span><span class="n">shape</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Error - shape of &quot;phi&quot; array does not match shape of &#39;</span> <span class="o">+</span> \
                                   <span class="s1">&#39;tipper array: </span><span class="si">%s</span><span class="s1"> ; </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">phi_array</span><span class="o">.</span><span class="n">shape</span><span class="p">),</span>
                                                              <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tipper</span><span class="o">.</span><span class="n">shape</span><span class="p">)))</span>
                <span class="k">return</span>
        <span class="k">else</span><span class="p">:</span>

            <span class="n">tipper_new</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">r_array</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="s1">&#39;complex&#39;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">r_array</span><span class="o">.</span><span class="n">shape</span> <span class="o">!=</span> <span class="n">phi_array</span><span class="o">.</span><span class="n">shape</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Error - shape of &quot;phi&quot; array does not match shape &#39;</span> <span class="o">+</span> \
                                   <span class="s1">&#39;of &quot;r&quot; array: </span><span class="si">%s</span><span class="s1"> ; </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">phi_array</span><span class="o">.</span><span class="n">shape</span><span class="p">),</span>
                                                              <span class="nb">str</span><span class="p">(</span><span class="n">r_array</span><span class="o">.</span><span class="n">shape</span><span class="p">)))</span>
                <span class="k">return</span>

        <span class="c1"># assert real array:</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">r_array</span><span class="p">))</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Error - array &quot;r&quot; is not real valued !&#39;</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">phi_array</span><span class="p">))</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Error - array &quot;phi&quot; is not real valued !&#39;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="k">for</span> <span class="n">idx_f</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">r_array</span><span class="p">)):</span>
            <span class="k">for</span> <span class="n">jj</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
                <span class="n">tipper_new</span><span class="p">[</span><span class="n">idx_f</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">jj</span><span class="p">]</span> <span class="o">=</span> <span class="n">cmath</span><span class="o">.</span><span class="n">rect</span><span class="p">(</span><span class="n">r_array</span><span class="p">[</span><span class="n">idx_f</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">jj</span><span class="p">],</span>
                                                      <span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">phi_array</span><span class="p">[</span><span class="n">idx_f</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">jj</span><span class="p">]))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">tipper</span> <span class="o">=</span> <span class="n">tipper_new</span>

        <span class="c1"># for consistency recalculate amplitude and phase</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">compute_amp_phase</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">compute_mag_direction</span><span class="p">()</span></div>

    <span class="c1"># ---------------------------------</span>
    <span class="c1"># properties</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">amplitude</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_amplitude</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">phase</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_phase</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">amplitude_err</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_amplitude_err</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">phase_err</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_phase_err</span>

    <span class="c1"># ----magnitude and direction----------------------------------------------</span>
<div class="viewcode-block" id="Tipper.compute_mag_direction"><a class="viewcode-back" href="../../../core.html#mtpy.core.z.Tipper.compute_mag_direction">[docs]</a>    <span class="k">def</span> <span class="nf">compute_mag_direction</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        computes the magnitude and direction of the real and imaginary</span>
<span class="sd">        induction vectors.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tipper</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_mag_real</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tipper</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">real</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> \
                                 <span class="bp">self</span><span class="o">.</span><span class="n">tipper</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">real</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_mag_imag</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tipper</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imag</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span>
                                 <span class="bp">self</span><span class="o">.</span><span class="n">tipper</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imag</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_mag_err</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_angle_err</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1"># get the angle, need to make both parts negative to get it into the</span>
        <span class="c1"># parkinson convention where the arrows point towards the conductor</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_angle_real</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">rad2deg</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">tipper</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">real</span><span class="p">,</span>
                                                 <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">tipper</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">real</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_angle_imag</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">rad2deg</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">tipper</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imag</span><span class="p">,</span>
                                                 <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">tipper</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imag</span><span class="p">))</span>

        <span class="c1">## estimate error: THIS MAYBE A HACK</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tipper_err</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_mag_err</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tipper_err</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> \
                                    <span class="bp">self</span><span class="o">.</span><span class="n">tipper_err</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_angle_err</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">rad2deg</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tipper_err</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                                                    <span class="bp">self</span><span class="o">.</span><span class="n">tipper_err</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]))</span> <span class="o">%</span> <span class="mi">45</span></div>

<div class="viewcode-block" id="Tipper.set_mag_direction"><a class="viewcode-back" href="../../../core.html#mtpy.core.z.Tipper.set_mag_direction">[docs]</a>    <span class="k">def</span> <span class="nf">set_mag_direction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mag_real</span><span class="p">,</span> <span class="n">ang_real</span><span class="p">,</span> <span class="n">mag_imag</span><span class="p">,</span> <span class="n">ang_imag</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        computes the tipper from the magnitude and direction of the real</span>
<span class="sd">        and imaginary components.</span>

<span class="sd">        Updates tipper</span>

<span class="sd">        No error propagation yet</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">tipper</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">real</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">mag_real</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan</span><span class="p">(</span><span class="n">ang_real</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> \
                                            <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan</span><span class="p">(</span><span class="n">ang_real</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">tipper</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">real</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">mag_real</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">/</span> \
                                            <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan</span><span class="p">(</span><span class="n">ang_real</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">tipper</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imag</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">mag_imag</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan</span><span class="p">(</span><span class="n">ang_imag</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> \
                                            <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan</span><span class="p">(</span><span class="n">ang_imag</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">tipper</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imag</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">mag_imag</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">/</span> \
                                            <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan</span><span class="p">(</span><span class="n">ang_imag</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">))</span>
        <span class="c1"># for consistency recalculate mag and angle</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">compute_mag_direction</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">compute_amp_phase</span><span class="p">()</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">mag_real</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mag_real</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">mag_imag</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mag_imag</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">angle_real</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_angle_real</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">angle_imag</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_angle_imag</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">mag_err</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mag_err</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">angle_err</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_angle_err</span>

    <span class="c1"># ----rotate---------------------------------------------------------------</span>
<div class="viewcode-block" id="Tipper.rotate"><a class="viewcode-back" href="../../../core.html#mtpy.core.z.Tipper.rotate">[docs]</a>    <span class="k">def</span> <span class="nf">rotate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">alpha</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Rotate  Tipper array.</span>

<span class="sd">        Rotation angle must be given in degrees. All angles are referenced</span>
<span class="sd">        to geographic North=0, positive in clockwise direction.</span>
<span class="sd">        (Mathematically negative!)</span>

<span class="sd">        In non-rotated state, &#39;X&#39; refs to North and &#39;Y&#39; to East direction.</span>

<span class="sd">        Updates the attributes:</span>
<span class="sd">    			* *tipper*</span>
<span class="sd">    			* *tipper_err*</span>
<span class="sd">    			* *rotation_angle*</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tipper</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;tipper array is &quot;None&quot; - I cannot rotate that&#39;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="c1"># check for iterable list/set of angles - if so, it must have length 1</span>
        <span class="c1"># or same as len(tipper):</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">iterable</span><span class="p">(</span><span class="n">alpha</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">degreeangle</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">alpha</span> <span class="o">%</span> <span class="mi">360</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;&quot;Angle&quot; must be a valid number (in degrees)&#39;</span><span class="p">)</span>
                <span class="k">return</span>

            <span class="c1"># make an n long list of identical angles</span>
            <span class="n">lo_angles</span> <span class="o">=</span> <span class="p">[</span><span class="n">degreeangle</span> <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tipper</span><span class="p">]</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">alpha</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">degreeangle</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">alpha</span> <span class="o">%</span> <span class="mi">360</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;&quot;Angle&quot; must be a valid number (in degrees)&#39;</span><span class="p">)</span>
                <span class="k">return</span>
            <span class="c1"># make an n long list of identical angles</span>
            <span class="n">lo_angles</span> <span class="o">=</span> <span class="p">[</span><span class="n">degreeangle</span> <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tipper</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">lo_angles</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">ii</span> <span class="o">%</span> <span class="mi">360</span><span class="p">)</span> <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="n">alpha</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;&quot;Angles&quot; must be valid numbers (in degrees)&#39;</span><span class="p">)</span>
                <span class="k">return</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">rotation_angle</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([(</span><span class="n">oldangle</span> <span class="o">+</span> <span class="n">lo_angles</span><span class="p">[</span><span class="n">ii</span><span class="p">])</span> <span class="o">%</span> <span class="mi">360</span>
                                        <span class="k">for</span> <span class="n">ii</span><span class="p">,</span> <span class="n">oldangle</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rotation_angle</span><span class="p">)])</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">lo_angles</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tipper</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Wrong number Number of &quot;angles&quot; - need </span><span class="si">%i</span><span class="s1">i &#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tipper</span><span class="p">)))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rotation_angle</span> <span class="o">=</span> <span class="mf">0.</span>
            <span class="k">return</span>

        <span class="n">tipper_rot</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tipper</span><span class="p">)</span>
        <span class="n">tipper_err_rot</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tipper_err</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">idx_freq</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">tipper_rot</span><span class="p">)):</span>
            <span class="n">angle</span> <span class="o">=</span> <span class="n">lo_angles</span><span class="p">[</span><span class="n">idx_freq</span><span class="p">]</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tipper_err</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">tipper_rot</span><span class="p">[</span><span class="n">idx_freq</span><span class="p">],</span> <span class="n">tipper_err_rot</span><span class="p">[</span><span class="n">idx_freq</span><span class="p">]</span> <span class="o">=</span> \
                    <span class="n">MTcc</span><span class="o">.</span><span class="n">rotatevector_incl_errors</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tipper</span><span class="p">[</span><span class="n">idx_freq</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:],</span>
                                                  <span class="n">angle</span><span class="p">,</span>
                                                  <span class="bp">self</span><span class="o">.</span><span class="n">tipper_err</span><span class="p">[</span><span class="n">idx_freq</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">tipper_rot</span><span class="p">[</span><span class="n">idx_freq</span><span class="p">],</span> <span class="n">tipper_err_rot</span> <span class="o">=</span> \
                    <span class="n">MTcc</span><span class="o">.</span><span class="n">rotatevector_incl_errors</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tipper</span><span class="p">[</span><span class="n">idx_freq</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:],</span>
                                                  <span class="n">angle</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">tipper</span> <span class="o">=</span> <span class="n">tipper_rot</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tipper_err</span> <span class="o">=</span> <span class="n">tipper_err_rot</span>

        <span class="c1"># for consistency recalculate mag and angle</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">compute_mag_direction</span><span class="p">()</span>

        <span class="c1"># for consistency recalculate amplitude and phase</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">compute_amp_phase</span><span class="p">()</span></div></div>


<span class="c1"># ------------------------</span>
<div class="viewcode-block" id="correct4sensor_orientation"><a class="viewcode-back" href="../../../core.html#mtpy.core.z.correct4sensor_orientation">[docs]</a><span class="k">def</span> <span class="nf">correct4sensor_orientation</span><span class="p">(</span><span class="n">Z_prime</span><span class="p">,</span> <span class="n">Bx</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">By</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span> <span class="n">Ex</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">Ey</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span>
                               <span class="n">Z_prime_error</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Correct a Z-array for wrong orientation of the sensors.</span>

<span class="sd">    Assume, E&#39; is measured by sensors orientated with the angles</span>
<span class="sd">        E&#39;x: a</span>
<span class="sd">        E&#39;y: b</span>

<span class="sd">    Assume, B&#39; is measured by sensors orientated with the angles</span>
<span class="sd">        B&#39;x: c</span>
<span class="sd">        B&#39;y: d</span>

<span class="sd">    With those data, one obtained the impedance tensor Z&#39;:</span>
<span class="sd">        E&#39; = Z&#39; * B&#39;</span>

<span class="sd">    Now we define change-of-basis matrices T,U so that</span>
<span class="sd">        E = T * E&#39;</span>
<span class="sd">        B = U * B&#39;</span>

<span class="sd">    =&gt;   T contains the expression of the E&#39;-basis in terms of E</span>
<span class="sd">    (the standard basis)</span>
<span class="sd">    and  U contains the expression of the B&#39;-basis in terms of B</span>
<span class="sd">    (the standard basis)</span>
<span class="sd">    The respective expressions for E&#39;x-basis vector and E&#39;y-basis</span>
<span class="sd">    vector are the columns of T.</span>
<span class="sd">    The respective expressions for B&#39;x-basis vector and B&#39;y-basis</span>
<span class="sd">    vector are the columns of U.</span>

<span class="sd">    We obtain the impedance tensor in default coordinates as:</span>

<span class="sd">    E&#39; = Z&#39; * B&#39; =&gt; T^(-1) * E = Z&#39; * U^(-1) * B</span>
<span class="sd">                 =&gt; E = T * Z&#39; * U^(-1) * B</span>
<span class="sd">                 =&gt; Z = T * Z&#39; * U^(-1)</span>

<span class="sd">    :param Z_prime: impedance tensor to be adjusted</span>
<span class="sd">    :dtype Z_prime: np.ndarray(num_freq, 2, 2, dtype=&#39;complex&#39;)</span>


<span class="sd">    :param Bx: orientation of Bx relative to geographic north (0)</span>
<span class="sd">				   *default* is 0</span>
<span class="sd">    :type Bx: float (angle in degrees)</span>

<span class="sd">    :param By:</span>
<span class="sd">    :type By: float (angle in degrees)</span>
<span class="sd">		         orientation of By relative to geographic north (0)</span>
<span class="sd">				 *default* is 90</span>

<span class="sd">    :param Ex: orientation of Ex relative to geographic north (0)</span>
<span class="sd">				   *default* is 0</span>
<span class="sd">    :type Ex: float (angle in degrees)</span>

<span class="sd">    :param Ey: orientation of Ey relative to geographic north (0)</span>
<span class="sd">				  *default* is 90</span>
<span class="sd">    :type Ey: float (angle in degrees)</span>

<span class="sd">    :param Z_prime_error: impedance tensor error (std)</span>
<span class="sd">            					 *default* is None</span>
<span class="sd">    :type Z_prime_error: np.ndarray(Z_prime.shape)</span>

<span class="sd">    :returns: adjusted impedance tensor</span>
<span class="sd">    :rtype: np.ndarray(Z_prime.shape, dtype=&#39;complex&#39;)</span>

<span class="sd">    :returns: impedance tensor standard deviation in</span>
<span class="sd">					default orientation</span>
<span class="sd">    :rtype: np.ndarray(Z_prime.shape, dtype=&#39;real&#39;)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">Z_prime</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">raise</span>
        <span class="k">if</span> <span class="n">Z_prime</span><span class="o">.</span><span class="n">shape</span> <span class="o">!=</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">):</span>
            <span class="k">raise</span>

        <span class="k">if</span> <span class="n">Z_prime</span><span class="o">.</span><span class="n">dtype</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;complex&#39;</span><span class="p">,</span> <span class="s1">&#39;float&#39;</span><span class="p">,</span> <span class="s1">&#39;int&#39;</span><span class="p">]:</span>
            <span class="k">raise</span>

        <span class="n">Z_prime</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">Z_prime</span><span class="p">)</span>

    <span class="k">except</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">MTex</span><span class="o">.</span><span class="n">MTpyError_inputarguments</span><span class="p">(</span><span class="s1">&#39;ERROR - Z array not valid!&#39;</span> <span class="o">+</span> \
                                            <span class="s1">&#39;Must be 2x2 complex array&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">Z_prime_error</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">Z_prime_error</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
                <span class="k">raise</span>
            <span class="k">if</span> <span class="n">Z_prime_error</span><span class="o">.</span><span class="n">shape</span> <span class="o">!=</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">):</span>
                <span class="k">raise</span>

            <span class="k">if</span> <span class="n">Z_prime_error</span><span class="o">.</span><span class="n">dtype</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;float&#39;</span><span class="p">,</span> <span class="s1">&#39;int&#39;</span><span class="p">]:</span>
                <span class="k">raise</span>

        <span class="k">except</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">MTex</span><span class="o">.</span><span class="n">MTpyError_inputarguments</span><span class="p">(</span><span class="s1">&#39;ERROR - Z-error array not&#39;</span> <span class="o">+</span> \
                                                <span class="s1">&#39;valid! Must be 2x2 real array&#39;</span><span class="p">)</span>

    <span class="n">T</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)))</span>
    <span class="n">U</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)))</span>

    <span class="n">dummy1</span> <span class="o">=</span> <span class="n">cmath</span><span class="o">.</span><span class="n">rect</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">Ex</span><span class="p">))</span>

    <span class="n">T</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">dummy1</span><span class="p">)</span>
    <span class="n">T</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">dummy1</span><span class="p">)</span>
    <span class="n">dummy2</span> <span class="o">=</span> <span class="n">cmath</span><span class="o">.</span><span class="n">rect</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">Ey</span><span class="p">))</span>
    <span class="n">T</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">dummy2</span><span class="p">)</span>
    <span class="n">T</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">dummy2</span><span class="p">)</span>

    <span class="n">dummy3</span> <span class="o">=</span> <span class="n">cmath</span><span class="o">.</span><span class="n">rect</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">Bx</span><span class="p">))</span>
    <span class="n">U</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">dummy3</span><span class="p">)</span>
    <span class="n">U</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">dummy3</span><span class="p">)</span>
    <span class="n">dummy4</span> <span class="o">=</span> <span class="n">cmath</span><span class="o">.</span><span class="n">rect</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">By</span><span class="p">))</span>
    <span class="n">U</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">dummy4</span><span class="p">)</span>
    <span class="n">U</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">dummy4</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">z_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">T</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">Z_prime</span><span class="p">,</span> <span class="n">U</span><span class="o">.</span><span class="n">I</span><span class="p">)))</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">MTex</span><span class="o">.</span><span class="n">MTpyError_inputarguments</span><span class="p">(</span><span class="s2">&quot;ERROR - Given angles do not&quot;</span> <span class="o">+</span> \
                                            <span class="s2">&quot;define basis for 2 dimensions - cannot convert Z&#39;&quot;</span><span class="p">)</span>

    <span class="n">z_err_arr</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">Z_prime_error</span><span class="p">)</span>

    <span class="c1"># TODO: calculate error propagation</span>

    <span class="k">return</span> <span class="n">z_arr</span><span class="p">,</span> <span class="n">z_err_arr</span></div>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../master_doc.html">mtpy 1.01.01 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" >Module code</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2018, Geoscience Australia.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.7.2.
    </div>
  </body>
</html>